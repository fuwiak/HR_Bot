# Настройка Qdrant для векторного поиска услуг

## Что делает Qdrant?

Qdrant - векторная база данных, которая хранит услуги из Google Sheets в виде эмбеддингов. Это позволяет выполнять семантический поиск, находить услуги даже если пользователь написал их по-другому (например, "бритье головы" найдет "Бритье головы").

**Преимущества:**
- ✅ Точный поиск услуг по смыслу
- ✅ Нет выдумывания цен AI - используются только данные из Google Sheets
- ✅ Автоматическое обновление при изменениях в Google Sheets

## Установка Qdrant

### Вариант 1: Локально (для разработки)

```bash
# Используя Docker
docker run -p 6333:6333 -p 6334:6334 qdrant/qdrant

# Или через pip (легковесная версия для тестирования)
pip install qdrant-client
```

### Вариант 2: Qdrant Cloud (для продакшена)

1. Зарегистрируйтесь на https://cloud.qdrant.io
2. Создайте кластер
3. Получите URL и API ключ
4. Установите переменные окружения:
   ```
   QDRANT_URL=https://your-cluster.qdrant.io
   QDRANT_API_KEY=your_api_key
   ```

### Вариант 3: Railway (если используете Railway для деплоя)

Добавьте Qdrant как сервис в Railway или используйте внешний Qdrant Cloud.

## Переменные окружения

```bash
# Опционально (по умолчанию: http://localhost:6333)
QDRANT_URL=http://localhost:6333

# Опционально (если используете Qdrant Cloud)
QDRANT_API_KEY=your_api_key
```

## Как это работает

1. **При старте бота:**
   - Бот читает все услуги из Google Sheets
   - Создает эмбеддинги для каждой услуги
   - Сохраняет их в Qdrant

2. **При поиске услуги:**
   - Пользователь пишет "Бритье головы?"
   - Бот создает эмбеддинг для этого запроса
   - Ищет в Qdrant наиболее похожую услугу
   - Возвращает точную цену из Google Sheets (1700₽)

3. **При изменениях в Google Sheets:**
   - Индекс автоматически обновляется при чтении данных
   - Qdrant всегда содержит актуальные данные

## Проверка работы

После запуска бота в логах должно быть:
```
✅ Qdrant клиент успешно подключен: http://localhost:6333
✅ Модель для эмбеддингов загружена
✅ Создана коллекция 'romanbot_services' в Qdrant
✅ Индексировано X услуг в Qdrant
```

## Если Qdrant недоступен

Бот продолжит работать, но будет использовать обычный текстовый поиск вместо векторного. В логах будет:
```
⚠️ Qdrant модуль не доступен
```

## Производительность

- Первый запуск: может занять 1-2 минуты (загрузка модели эмбеддингов)
- Последующие запуски: быстро (модель кэшируется)
- Поиск: <100ms (очень быстро)

## Модель эмбеддингов

Используется `intfloat/multilingual-e5-base` - поддерживает русский язык и работает хорошо для поиска услуг.

