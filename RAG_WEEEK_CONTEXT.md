# üîç RAG + WEEEK Context Integration

## ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

DeepSeek (—á–µ—Ä–µ–∑ OpenRouter) —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑:
1. **Qdrant Cloud (RAG)** - —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
2. **WEEEK** - –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ –∑–∞–¥–∞—á–∏

---

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –û–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, –±–æ—Ç:

1. **–ò—â–µ—Ç –≤ Qdrant:**
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–∞
   - –ò—â–µ—Ç —Ç–æ–ø-3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ (–¥–æ 300 —Å–∏–º–≤–æ–ª–æ–≤)

2. **–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ WEEEK:**
   - –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (—Ç–æ–ø-5)
   - –ó–∞–¥–∞—á–∏ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (—Ç–æ–ø-3 –Ω–∞ –ø—Ä–æ–µ–∫—Ç)
   - –°—Ç–∞—Ç—É—Å –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

3. **–§–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM:**
   ```
   –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:
   
   üìÑ –î–æ–∫—É–º–µ–Ω—Ç1.pdf (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: 0.85):
   [—Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞]
   
   üìÑ –î–æ–∫—É–º–µ–Ω—Ç2.docx (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: 0.78):
   [—Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞]
   
   –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ –∑–∞–¥–∞—á–∏ –≤ WEEEK:
   
   üìã –ü—Ä–æ–µ–∫—Ç: –ü–æ–¥–±–æ—Ä HR-–º–µ–Ω–µ–¥–∂–µ—Ä–∞ (ID: 1)
     ‚Ä¢ –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ö–ü
     ‚Ä¢ –ü—Ä–æ–≤–µ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–≤—å—é
     ‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Ñ—Ñ–µ—Ä
   ```

4. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ LLM:**
   - –ü—Ä–æ–º–ø—Ç —Å –∏—Å—Ç–æ—Ä–∏–µ–π –ø–µ—Ä–µ–ø–∏—Å–∫–∏
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ RAG
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ WEEEK
   - –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

### 2. –ö–æ–º–∞–Ω–¥–∞ `/summary`

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `/summary [–Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞]`:

1. **–ò—â–µ—Ç –ø—Ä–æ–µ–∫—Ç –≤ WEEEK:**
   - –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –±–µ—Ä–µ—Ç –ø–µ—Ä–≤—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π
   - –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏ (–∞–∫—Ç–∏–≤–Ω—ã–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ)

2. **–ò—â–µ—Ç –≤ RAG:**
   - –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–æ–µ–∫—Ç–∞
   - –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (—Ç–æ–ø-5)

3. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—é:**
   - –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
   - –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
   - –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
   - –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

---

## üìä –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –í–æ–ø—Ä–æ—Å –æ –ø—Ä–æ–µ–∫—Ç–µ

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** "–ö–∞–∫–æ–π —Å—Ç–∞—Ç—É—Å —É –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–¥–±–æ—Ä–∞?"

**–ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç:**
- –ò–∑ WEEEK: –ü—Ä–æ–µ–∫—Ç "–ü–æ–¥–±–æ—Ä HR-–º–µ–Ω–µ–¥–∂–µ—Ä–∞", 3 –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –ò–∑ RAG: –î–æ–∫—É–º–µ–Ω—Ç—ã –æ –ø–æ–¥–±–æ—Ä–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞

**–û—Ç–≤–µ—Ç –±–æ—Ç–∞:**
```
–ü—Ä–æ–µ–∫—Ç "–ü–æ–¥–±–æ—Ä HR-–º–µ–Ω–µ–¥–∂–µ—Ä–∞" –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç–∞–¥–∏–∏.

–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:
‚Ä¢ –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ö–ü —Å –∫–ª–∏–µ–Ω—Ç–æ–º
‚Ä¢ –ü—Ä–æ–≤–µ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–≤—å—é —Å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏
‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Ñ—Ñ–µ—Ä

–ù–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π, —Ä–µ–∫–æ–º–µ–Ω–¥—É—é...
```

---

### –ü—Ä–∏–º–µ—Ä 2: –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** `/summary –ü–æ–¥–±–æ—Ä HR-–º–µ–Ω–µ–¥–∂–µ—Ä–∞`

**–ë–æ—Ç:**
1. –ù–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–µ–∫—Ç –≤ WEEEK
2. –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏
3. –ò—â–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ RAG
4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—é

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ '–ü–æ–¥–±–æ—Ä HR-–º–µ–Ω–µ–¥–∂–µ—Ä–∞':

1. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:
   –ü—Ä–æ–µ–∫—Ç –ø–æ –ø–æ–¥–±–æ—Ä—É HR-–º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞...

2. –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
   –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á: 3
   –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö: 5
   –ü—Ä–æ–≥—Ä–µ—Å—Å: 62%

3. –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
   ‚Ä¢ –ü—Ä–æ–≤–µ–¥–µ–Ω–æ 5 –∏–Ω—Ç–µ—Ä–≤—å—é
   ‚Ä¢ –û—Ç–æ–±—Ä–∞–Ω–æ 2 –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
   ...

4. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
   ‚Ä¢ –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ö–ü
   ‚Ä¢ –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–≤—å—é
   ...

5. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
   –ù–∞ –æ—Å–Ω–æ–≤–µ –æ–ø—ã—Ç–∞ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π...
```

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `app.py`

**–§—É–Ω–∫—Ü–∏—è `reply()` (—Å—Ç—Ä–æ–∫–∞ ~3115):**

```python
# –£–ª—É—á—à–µ–Ω–Ω—ã–π RAG –ø–æ–∏—Å–∫ + –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ WEEEK
rag_context = ""
weeek_context = ""

# 1. –ü–æ–∏—Å–∫ –≤ Qdrant
query_embedding = await generate_embedding_async(text)
search_results = client.query_points(
    collection_name="hr2137_bot_knowledge_base",
    query=query_embedding,
    limit=5
)

# 2. –î–∞–Ω–Ω—ã–µ –∏–∑ WEEEK
projects = await get_projects()
tasks = await get_tasks(project_id=project_id)

# 3. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
full_context = rag_context + weeek_context
msg = msg.replace("{{rag_context}}", full_context)
```

**–§—É–Ω–∫—Ü–∏—è `summary_command()` (—Å—Ç—Ä–æ–∫–∞ ~3640):**

- –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ WEEEK
- –ò—â–µ—Ç –≤ RAG –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–æ–µ–∫—Ç–∞
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ LLM —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:**
   - LLM –≤–∏–¥–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ WEEEK
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ RAG

2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è:**
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª–µ–Ω
   - –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ –Ω–∞—Ö–æ–¥–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ RAG"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é: `hr2137_bot_knowledge_base`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Qdrant

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ WEEEK"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `WEEEEK_TOKEN` –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ API

### –ü—Ä–æ–±–ª–µ–º–∞: "LLM –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–º–ø—Ç –≤ `CONSULTING_PROMPT`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `{{rag_context}}` –∑–∞–º–µ–Ω—è–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞

---

## üìù –õ–æ–≥–∏

**–£—Å–ø–µ—à–Ω—ã–π –ø–æ–∏—Å–∫:**
```
‚úÖ –ù–∞–π–¥–µ–Ω–æ 3 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ RAG –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
‚úÖ –ü–æ–ª—É—á–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ WEEEK: 2 –ø—Ä–æ–µ–∫—Ç–æ–≤
```

**–û—à–∏–±–∫–∏:**
```
‚ö†Ô∏è –û—à–∏–±–∫–∞ RAG –ø–æ–∏—Å–∫–∞: [–¥–µ—Ç–∞–ª–∏]
‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ WEEEK: [–¥–µ—Ç–∞–ª–∏]
```

---

## üéâ –ì–æ—Ç–æ–≤–æ!

**–¢–µ–ø–µ—Ä—å DeepSeek –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:**
- ‚úÖ RAG (Qdrant Cloud) –¥–ª—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ WEEEK –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –∑–∞–¥–∞—á
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

**–í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! üöÄ**
