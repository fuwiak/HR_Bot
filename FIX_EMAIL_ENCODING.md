# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è email

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

```
'utf-8' codec can't decode byte 0xeb in position 0: invalid continuation byte
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–∏—Å—å–º–∞ –º–æ–≥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–¥–∏—Ä–æ–≤–∫–∞—Ö (Windows-1251, KOI8-R, ISO-8859-5 –∏ –¥—Ä.), –∞ –∫–æ–¥ –ø—ã—Ç–∞–ª—Å—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–∞–∫ UTF-8.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_safe_decode()` –≤ `email_helper.py`, –∫–æ—Ç–æ—Ä–∞—è:

1. **–ü—Ä–æ–±—É–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏** –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:
   - UTF-8 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
   - Windows-1251 (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞ Windows)
   - KOI8-R (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞ Unix)
   - CP1251 (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
   - ISO-8859-1 (Latin-1)
   - ISO-8859-5 (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞ ISO)
   - Latin1, ASCII

2. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç charset –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤** –ø–∏—Å—å–º–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)

3. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º:** –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UTF-8 —Å `errors='replace'` –∏–ª–∏ `errors='ignore'`

---

## üîÑ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –î–æ:
```python
body = part.get_payload(decode=True).decode()  # –¢–æ–ª—å–∫–æ UTF-8
```

### –ü–æ—Å–ª–µ:
```python
payload = part.get_payload(decode=True)
charset = part.get_content_charset() or "utf-8"
body = _safe_decode(payload, charset)  # –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∫–æ–¥–∏—Ä–æ–≤–æ–∫
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –±–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∏—Å—å–º–∞ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–¥–∏—Ä–æ–≤–∫–∞—Ö:
- ‚úÖ UTF-8
- ‚úÖ Windows-1251 (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
- ‚úÖ KOI8-R (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
- ‚úÖ ISO-8859-5 (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
- ‚úÖ –î—Ä—É–≥–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–†—Ä—Ä–ø–ø")
3. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø–∏—Å—å–º–æ

---

## üìù –õ–æ–≥–∏

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏:
- ‚úÖ –ü–∏—Å—å–º–æ –±—É–¥–µ—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–æ –≤ Telegram

–ü—Ä–∏ –æ—à–∏–±–∫–µ (fallback):
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö, –Ω–æ –ø–∏—Å—å–º–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω–æ
- ‚úÖ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–æ (–≤–æ–∑–º–æ–∂–Ω–æ —Å –∑–∞–º–µ–Ω–æ–π –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤)

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –ë–æ—Ç —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∏—Å—å–º–∞ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–¥–∏—Ä–æ–≤–∫–∞—Ö! üöÄ
