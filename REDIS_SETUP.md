# üî¥ Redis + PostgreSQL: –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é

## –û–±–∑–æ—Ä

Telegram –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Redis** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –∫–æ–Ω–≤–µ—Ä—Å–∞—Ü–∏–∏ –∏ **PostgreSQL** –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è. –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∏–∑ Redis –≤ PostgreSQL –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram  ‚îÇ
‚îÇ     Bot     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚ñ∫ Redis (–±—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å)
       ‚îÇ   ‚îî‚îÄ‚ñ∫ –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
       ‚îÇ       ‚îî‚îÄ‚ñ∫ PostgreSQL (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
       ‚îÇ
       ‚îî‚îÄ‚ñ∫ RAM (fallback –µ—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–æ—Å—Ç—É–ø–∞:

1. **–ß—Ç–µ–Ω–∏–µ:** Redis ‚Üí PostgreSQL ‚Üí RAM
2. **–ó–∞–ø–∏—Å—å:** Redis + PostgreSQL (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** Redis ‚Üí PostgreSQL (—Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ **–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø** - Redis –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
- ‚úÖ **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - PostgreSQL —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–≤—Å–µ–≥–¥–∞
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - Redis –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –î–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Å–±–æ—è—Ö Redis

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Redis –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Railway.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Railway

Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Redis —Å–µ—Ä–≤–∏—Å–∞:

```bash
REDIS_URL="redis://default:password@railway-private-domain:6379"
REDIS_PUBLIC_URL="redis://default:password@railway-tcp-proxy-domain:port"
REDISHOST="railway-private-domain"
REDISPORT="6379"
REDISPASSWORD="password"
REDISUSER="default"
```

**–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `REDIS_URL` –∏–ª–∏ `REDIS_PUBLIC_URL` –µ—Å–ª–∏ –æ–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ã.**

## –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Redis

### –ö–ª—é—á–∏:

1. **user_memory:{user_id}** - –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –§–æ—Ä–º–∞—Ç: JSON –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
   - TTL: 1 —á–∞—Å (3600 —Å–µ–∫—É–Ω–¥)
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ PostgreSQL

2. **user_data:{user_id}:phone** - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   - TTL: 1 —á–∞—Å
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ PostgreSQL

3. **user_data:{user_id}:booking** - –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
   - –§–æ—Ä–º–∞—Ç: JSON –æ–±—ä–µ–∫—Ç
   - TTL: 1 —á–∞—Å
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ PostgreSQL

4. **email_subscribers** - –°–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
   - –§–æ—Ä–º–∞—Ç: JSON –º–∞—Å—Å–∏–≤ user_id
   - TTL: 24 —á–∞—Å–∞
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ PostgreSQL

## –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∏–∑ Redis –≤ PostgreSQL:

- ‚è∞ **–ò–Ω—Ç–µ—Ä–≤–∞–ª:** –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- üîÑ **–ü—Ä–æ—Ü–µ—Å—Å:** –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –±–æ—Ç–∞)
- ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Redis —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL

### –ß—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è:

1. –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–µ–ª–µ—Ñ–æ–Ω, booking data)
3. Email –ø–æ–¥–ø–∏—Å—á–∏–∫–∏

## Fallback –º–µ—Ö–∞–Ω–∏–∑–º

–ï—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –∏–ª–∏ RAM:

- ‚úÖ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL
- ‚úÖ Redis + PostgreSQL –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç RAM
- ‚úÖ –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ Redis —É–ø–∞–ª

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ Railway

### 1. –î–æ–±–∞–≤–∏—Ç—å Redis —Å–µ—Ä–≤–∏—Å

1. –í Railway Dashboard ‚Üí **"+ New"** ‚Üí **"Database"** ‚Üí **"Add Redis"**
2. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç Redis —Å–µ—Ä–≤–∏—Å
3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º

### 2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫ Telegram Bot —Å–µ—Ä–≤–∏—Å—É

Redis –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ **Shared Variables**:

- `REDIS_URL` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- `REDISHOST`, `REDISPORT`, `REDISPASSWORD` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã

**–ù–∏—á–µ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!**

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```
‚úÖ Redis –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ REDIS_URL
‚úÖ Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
üîÑ –ó–∞–ø—É—â–µ–Ω–∞ —Ñ–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Redis -> PostgreSQL (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Redis –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω:

```python
# –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤ (—á–∏—Ç–∞–µ—Ç –∏–∑ Redis, –ø–∏—à–µ—Ç –≤ Redis + PostgreSQL)
add_memory(user_id, "user", "–ü—Ä–∏–≤–µ—Ç!")
history = get_history(user_id)  # –ë—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ –∏–∑ Redis

# –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
set_user_phone(user_id, "+79991234567")  # Redis + PostgreSQL
phone = get_user_phone(user_id)  # –ë—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ –∏–∑ Redis

# Email –ø–æ–¥–ø–∏—Å—á–∏–∫–∏
add_email_subscriber(user_id)  # Redis + PostgreSQL
subscribers = get_email_subscribers()  # –ë—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ –∏–∑ Redis
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É Redis, PostgreSQL –∏ RAM:

- ‚úÖ –ï—Å–ª–∏ Redis –¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Redis –¥–ª—è —á—Ç–µ–Ω–∏—è
- ‚úÖ –ï—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL
- ‚úÖ –ï—Å–ª–∏ –æ–±–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RAM (fallback)

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Redis vs PostgreSQL vs RAM:

| –û–ø–µ—Ä–∞—Ü–∏—è | Redis | PostgreSQL | RAM |
|----------|-------|------------|-----|
| –ß—Ç–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ | ~1ms | ~10-50ms | ~0.1ms |
| –ó–∞–ø–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è | ~1ms | ~10-50ms | ~0.1ms |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å | ‚úÖ –í—ã—Å–æ–∫–∞—è | ‚úÖ –°—Ä–µ–¥–Ω—è—è | ‚ùå –ù–∏–∑–∫–∞—è |
| –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | ‚ö†Ô∏è TTL | ‚úÖ –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è | ‚ùå –ù–µ—Ç |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

- **–î–ª—è —á—Ç–µ–Ω–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Redis (–±—ã—Å—Ç—Ä–æ)
- **–î–ª—è –∑–∞–ø–∏—Å–∏:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Redis + PostgreSQL (–±—ã—Å—Ç—Ä–æ + –Ω–∞–¥–µ–∂–Ω–æ)
- **–î–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PostgreSQL (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```python
from redis_helper import get_redis_client

client = get_redis_client()
if client:
    print("‚úÖ Redis –ø–æ–¥–∫–ª—é—á–µ–Ω")
    client.ping()  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
else:
    print("‚ùå Redis –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω")
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```python
from redis_helper import get_redis_client

client = get_redis_client()
if client:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Redis
    user_keys = client.keys("user_memory:*")
    print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Redis: {len(user_keys)}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
    subscribers = get_email_subscribers_redis()
    print(f"–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {len(subscribers)}")
```

## Troubleshooting

### –û—à–∏–±–∫–∞: redis –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

```
‚ö†Ô∏è redis –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install redis
```

**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `requirements.txt`

### –û—à–∏–±–∫–∞: Connection refused

```
‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è Redis –∫–ª–∏–µ–Ω—Ç–∞: Connection refused
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Redis —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω –Ω–∞ Railway
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `REDIS_URL`
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –≤ –æ–¥–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ Railway

### –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `üîÑ –ó–∞–ø—É—â–µ–Ω–∞ —Ñ–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è` ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `‚úÖ –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞` ‚Üí –≤—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

### Fallback –Ω–∞ PostgreSQL/RAM

–ï—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL –∏–ª–∏ RAM
- ‚ö†Ô∏è –ß—Ç–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ

## TTL (Time To Live)

–ö–ª—é—á–∏ –≤ Redis –∏–º–µ—é—Ç TTL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏:

- **user_memory:** 1 —á–∞—Å (3600 —Å–µ–∫—É–Ω–¥)
- **user_data:** 1 —á–∞—Å (3600 —Å–µ–∫—É–Ω–¥)
- **email_subscribers:** 24 —á–∞—Å–∞ (86400 —Å–µ–∫—É–Ω–¥)

**–í–∞–∂–Ω–æ:** –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ PostgreSQL –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Redis + PostgreSQL (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ Railway)
2. **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ PostgreSQL –ª–æ–∫–∞–ª—å–Ω–æ
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** Redis –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç —á—Ç–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- `redis_helper.py` - –ú–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å Redis
- `database.py` - –ú–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
- `app.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º
- Railway Dashboard ‚Üí Redis ‚Üí **Data** - –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
