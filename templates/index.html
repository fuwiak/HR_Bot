{% extends "base.html" %}

{% block content %}
<div class="content-card">
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
    <p class="subtitle">–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥–æ–≤–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏</p>
    
    <div class="grid">
        <!-- Email Demo -->
        <div class="card" id="email-demo">
            <h2>üìß –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è Email</h2>
            <p>–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ email –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤</p>
            <form id="emailForm">
                <div class="form-group">
                    <label>–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</label>
                    <input type="email" name="recipient" required placeholder="email@example.com">
                </div>
                <div class="form-group">
                    <label>–¢–µ–º–∞:</label>
                    <input type="text" name="subject" required placeholder="–¢–µ–º–∞ –ø–∏—Å—å–º–∞">
                </div>
                <div class="form-group">
                    <label>–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea name="body" required placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..."></textarea>
                </div>
                <button type="submit" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
            <div id="emailResult" class="result" style="display:none;"></div>
        </div>
        
        <!-- Proposal Demo -->
        <div class="card" id="proposal-demo">
            <h2>üìù –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ö–ü</h2>
            <p>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å—É –∫–ª–∏–µ–Ω—Ç–∞</p>
            <form id="proposalForm">
                <div class="form-group">
                    <label>–ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞:</label>
                    <textarea name="request" required placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞..."></textarea>
                </div>
                <button type="submit" class="btn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ö–ü</button>
            </form>
            <div id="proposalResult" class="result" style="display:none;"></div>
        </div>
        
        <!-- RAG Search -->
        <div class="card" id="rag-search">
            <h2>üîç –ü–æ–∏—Å–∫ –≤ RAG</h2>
            <p>–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</p>
            <form id="ragSearchForm">
                <div class="form-group">
                    <label>–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:</label>
                    <input type="text" name="query" required placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å...">
                </div>
                <button type="submit" class="btn">–ò—Å–∫–∞—Ç—å</button>
            </form>
            <div id="ragSearchResult" class="result" style="display:none;"></div>
        </div>
        
        <!-- RAG Stats -->
        <div class="card" id="rag-stats">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ RAG</h2>
            <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</p>
            <button onclick="loadRAGStats()" class="btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
            <div id="ragStatsResult" class="result" style="display:none;"></div>
        </div>
        
        <!-- RAG Docs -->
        <div class="card" id="rag-docs">
            <h2>üìö –î–æ–∫—É–º–µ–Ω—Ç—ã –≤ –±–∞–∑–µ</h2>
            <p>–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ RAG –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</p>
            <button onclick="loadRAGDocs()" class="btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã</button>
            <div id="ragDocsResult" class="result" style="display:none;"></div>
        </div>
        
        <!-- RAG Dashboard -->
        <div class="card" id="rag-dashboard" style="grid-column: 1 / -1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
            <h2 style="color: white;">üìä RAG Dashboard - –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π</h2>
            <p style="color: rgba(255,255,255,0.9);">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î, –º–µ—Ç—Ä–∏–∫–∏, –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞, –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤</p>
            <div style="display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap;">
                <a href="/rag" class="btn" style="background: white; color: #667eea; font-weight: 600; padding: 12px 24px; text-decoration: none;">‚ñ∂ –û—Ç–∫—Ä—ã—Ç—å RAG Dashboard</a>
                <span style="display: flex; align-items: center; gap: 8px; font-size: 14px; opacity: 0.9;">
                    <span>‚öôÔ∏è</span>
                    <span>–û—Ü–µ–Ω–∫–∞ ‚Ä¢ –ú–µ—Ç—Ä–∏–∫–∏ ‚Ä¢ Workflow ‚Ä¢ –§–∞–π–ª—ã ‚Ä¢ –¢–µ—Å—Ç—ã</span>
                </span>
            </div>
        </div>
        
        <!-- Architecture -->
        <div class="card">
            <h2>üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h2>
            <p>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–∏—Å—Ç–µ–º—ã</p>
            <a href="/architecture" class="btn">–ü—Ä–æ—Å–º–æ—Ç—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã</a>
        </div>
    </div>
</div>

<script>
    // Smooth scroll –¥–ª—è —è–∫–æ—Ä–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // Update URL without scrolling
                window.history.pushState(null, null, this.getAttribute('href'));
            }
        });
    });

    // Email form
    document.getElementById('emailForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="loading"></span> –û—Ç–ø—Ä–∞–≤–∫–∞...';
        
        try {
            const response = await fetch('/demo/email', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: new URLSearchParams(data)
            });
            const result = await response.json();
            const resultDiv = document.getElementById('emailResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<h3>‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!</h3><pre>${JSON.stringify(result, null, 2)}</pre>`;
            e.target.reset();
        } catch (error) {
            const resultDiv = document.getElementById('emailResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<h3>‚ùå –û—à–∏–±–∫–∞</h3><pre>${error.message}</pre>`;
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
        }
    });
    
    // Proposal form
    document.getElementById('proposalForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = {request: formData.get('request')};
        
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="loading"></span> –ì–µ–Ω–µ—Ä–∞—Ü–∏—è...';
        
        try {
            const response = await fetch('/demo/proposal', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            const result = await response.json();
            const resultDiv = document.getElementById('proposalResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<h3>‚úÖ –ö–ü —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ!</h3><pre>${JSON.stringify(result, null, 2)}</pre>`;
        } catch (error) {
            const resultDiv = document.getElementById('proposalResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<h3>‚ùå –û—à–∏–±–∫–∞</h3><pre>${error.message}</pre>`;
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
        }
    });
    
    // RAG Search form
    document.getElementById('ragSearchForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const query = new FormData(e.target).get('query');
        
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="loading"></span> –ü–æ–∏—Å–∫...';
        
        try {
            const response = await fetch(`/rag/search?query=${encodeURIComponent(query)}&limit=5`);
            const result = await response.json();
            const resultDiv = document.getElementById('ragSearchResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<h3>üîç –ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</h3><pre>${JSON.stringify(result, null, 2)}</pre>`;
        } catch (error) {
            const resultDiv = document.getElementById('ragSearchResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<h3>‚ùå –û—à–∏–±–∫–∞</h3><pre>${error.message}</pre>`;
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
        }
    });
    
    async function loadRAGStats() {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span> –ó–∞–≥—Ä—É–∑–∫–∞...';
        
        try {
            const response = await fetch('/rag/stats');
            const result = await response.json();
            const resultDiv = document.getElementById('ragStatsResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:</h3><pre>${JSON.stringify(result, null, 2)}</pre>`;
        } catch (error) {
            const resultDiv = document.getElementById('ragStatsResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<h3>‚ùå –û—à–∏–±–∫–∞</h3><pre>${error.message}</pre>`;
        } finally {
            btn.disabled = false;
            btn.textContent = originalText;
        }
    }
    
    async function loadRAGDocs() {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span> –ó–∞–≥—Ä—É–∑–∫–∞...';
        
        try {
            const response = await fetch('/rag/docs?limit=20');
            const result = await response.json();
            const resultDiv = document.getElementById('ragDocsResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<h3>üìö –î–æ–∫—É–º–µ–Ω—Ç—ã –≤ –±–∞–∑–µ (${result.total}):</h3><pre>${JSON.stringify(result, null, 2)}</pre>`;
        } catch (error) {
            const resultDiv = document.getElementById('ragDocsResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<h3>‚ùå –û—à–∏–±–∫–∞</h3><pre>${error.message}</pre>`;
        } finally {
            btn.disabled = false;
            btn.textContent = originalText;
        }
    }
</script>
{% endblock %}
