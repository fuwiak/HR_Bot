# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ Qdrant

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: ImportError get_embedding

**–û—à–∏–±–∫–∞:**
```
ImportError: cannot import name 'get_embedding' from 'qdrant_helper'
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–í `qdrant_helper.py` —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `generate_embedding_async`, –∞ –Ω–µ `get_embedding`.

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –≤ `app.py`:

```python
# –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
from qdrant_helper import get_embedding

# –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
from qdrant_helper import generate_embedding_async
```

–ò –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
# –ë—ã–ª–æ:
embedding = await get_embedding(doc["text"])

# –°—Ç–∞–ª–æ:
embedding = await generate_embedding_async(doc["text"])
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: ID —Ç–æ—á–µ–∫ –≤ Qdrant

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ ID –¥–ª—è —Ç–æ—á–µ–∫ –≤ Qdrant –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫–æ–≤—ã–π ID –≤ —á–∏—Å–ª–æ–≤–æ–π —á–µ—Ä–µ–∑ hash:

```python
# –°–æ–∑–¥–∞–µ–º —á–∏—Å–ª–æ–≤–æ–π ID –∏–∑ hash —Å—Ç—Ä–æ–∫–∏
point_id = abs(hash(doc["id"])) % (10 ** 10)

point = PointStruct(
    id=point_id,  # –ß–∏—Å–ª–æ–≤–æ–π ID
    vector=embedding,
    payload={
        # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
        "chunk_id": doc["id"]  # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä–æ–∫–æ–≤—ã–π ID –≤ payload
    }
)
```

---

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –í —Ñ—É–Ω–∫—Ü–∏–∏ `upload_to_qdrant()`:

**1. –ò–º–ø–æ—Ä—Ç:**
```python
from qdrant_helper import generate_embedding_async  # ‚úÖ
```

**2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤:**
```python
embedding = await generate_embedding_async(doc["text"])
```

**3. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–µ–∫:**
```python
point_id = abs(hash(doc["id"])) % (10 ** 10)
point = PointStruct(
    id=point_id,
    vector=embedding,
    payload={
        "text": doc["text"],
        "source": doc["metadata"]["source"],
        "doc_id": doc["metadata"]["doc_id"],
        "chunk_index": doc["metadata"]["chunk_index"],
        "uploaded_by": doc["metadata"]["uploaded_by"],
        "user_id": doc["metadata"]["user_id"],
        "category": doc["metadata"]["category"],
        "title": doc["metadata"]["title"],
        "chunk_id": doc["id"]  # –°—Ç—Ä–æ–∫–æ–≤—ã–π ID –≤ payload
    }
)
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ Word –¥–æ–∫—É–º–µ–Ω—Ç–∞:

```bash
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ Word —Ñ–∞–π–ª –≤ Telegram –±–æ—Ç
# –ù–∞–ø—Ä–∏–º–µ—Ä: –û–±—Ä–∞–∑–µ—Ü_–ø–∏—Å—å–º–∞.docx
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π!

üìÑ –§–∞–π–ª: –û–±—Ä–∞–∑–µ—Ü_–ø–∏—Å—å–º–∞.docx
üìä –°–æ–∑–¥–∞–Ω–æ —á–∞–Ω–∫–æ–≤: 15
üÜî ID –¥–æ–∫—É–º–µ–Ω—Ç–∞: abc-123-def

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —ç—Ç–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö:

```
‚úÖ –§–∞–π–ª —Å–∫–∞—á–∞–Ω: /tmp/xxx/file.docx
‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ 13464 —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ file.docx
üìÑ –°–æ–∑–¥–∞–Ω–æ 25 —á–∞–Ω–∫–æ–≤ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ file.docx
‚úÖ –≠–º–±–µ–¥–¥–∏–Ω–≥ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ API (—Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 1024)
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 25 —á–∞–Ω–∫–æ–≤ –≤ Qdrant
```

---

## API —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

**–ß–µ—Ä–µ–∑ OpenRouter (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
OPENROUTER_API_KEY=your_key
EMBEDDING_MODEL=qwen/qwen3-embedding-8b
EMBEDDING_DIMENSION=1024
```

**–ß–µ—Ä–µ–∑ OpenAI (fallback):**
```bash
OPENAI_API_KEY=your_key
EMBEDDING_MODEL=text-embedding-3-small
EMBEDDING_DIMENSION=1536
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. OpenRouter (Qwen3-Embedding-8B) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π
2. OpenAI (text-embedding-3-small) ‚Äî fallback

---

## –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤–µ–∫—Ç–æ—Ä–æ–≤

| –ú–æ–¥–µ–ª—å | API | –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å |
|--------|-----|-------------|
| qwen/qwen3-embedding-8b | OpenRouter | 1024 |
| text-embedding-3-small | OpenAI | 1536 |

**–í–∞–∂–Ω–æ:** –ö–æ–ª–ª–µ–∫—Ü–∏—è –≤ Qdrant –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å—é!

---

## –ò—Ç–æ–≥–æ

‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `generate_embedding_async`  
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏  
‚úÖ ID —Ç–æ—á–µ–∫ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ —á–∏—Å–ª–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç  
‚úÖ –°—Ç—Ä–æ–∫–æ–≤—ã–π ID —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ payload  
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Word –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (.docx)  
‚úÖ –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  

**–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ**
