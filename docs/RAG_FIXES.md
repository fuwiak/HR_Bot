# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è RAG –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ü–µ–Ω

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –°–º–µ—à–∏–≤–∞–Ω–∏–µ —É—Å–ª—É–≥ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –ø–æ–∏—Å–∫–µ

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ–∏—Å–∫ –≤–æ–∑–≤—Ä–∞—â–∞–ª –¥–æ–∫—É–º–µ–Ω—Ç—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –≤–º–µ—Å—Ç–æ —É—Å–ª—É–≥
- –í—Å–µ —É—Å–ª—É–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ `0‚ÇΩ` –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω
- –í –ª–æ–≥–∞—Ö: `üìã –†–∞–±–æ—á–∞—è_—Ç–µ—Ç—Ä–∞–¥—å_—Ç—Ä–µ–Ω–∏–Ω–≥–∞_–ò–ò_HR_—Ñ–∏–Ω.docx - 0‚ÇΩ`

**–ü—Ä–∏—á–∏–Ω–∞:**
- –í –∫–æ–ª–ª–µ–∫—Ü–∏–∏ Qdrant —Å–º–µ—à–∞–Ω—ã —É—Å–ª—É–≥–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- –ü–æ–∏—Å–∫ –Ω–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª –ø–æ —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `source_type="service"` –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —É—Å–ª—É–≥
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä –≤ `search_service()` –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–æ–ª—å–∫–æ —É—Å–ª—É–≥
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ü–∏–∫–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 2. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ typing indicator –≤ Telegram

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–µ–ª, —á—Ç–æ –±–æ—Ç "–ø–µ—á–∞—Ç–∞–µ—Ç" –æ—Ç–≤–µ—Ç
- –ù–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `send_chat_action(ChatAction.TYPING)` –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ (—Ü–µ–Ω—ã –∏ –æ–±—â–∏–µ)

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### `qdrant_helper.py`

1. **–î–æ–±–∞–≤–ª–µ–Ω `source_type="service"` –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**
```python
payload = {
    ...
    "source_type": "service"  # –ú–∞—Ä–∫–µ—Ä –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —É—Å–ª—É–≥
}
```

2. **–î–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä –≤ `search_service()`:**
```python
from qdrant_client.models import Filter, FieldCondition, MatchValue

service_filter = Filter(
    must=[
        FieldCondition(
            key="source_type",
            match=MatchValue(value="service")
        )
    ]
)

search_results = client.query_points(
    collection_name=COLLECTION_NAME,
    query=query_embedding,
    limit=limit * 2,
    query_filter=service_filter
)
```

3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
```python
# –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã (–µ—Å–ª–∏ –Ω–µ—Ç id –∏–ª–∏ title –ø—É—Å—Ç–æ–π)
if not payload.get("id") and not payload.get("title"):
    continue

# –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
if payload.get("file_name") or payload.get("text"):
    if payload.get("source_type") != "service":
        continue
```

### `app.py`

**–î–æ–±–∞–≤–ª–µ–Ω typing indicator:**
```python
from telegram import ChatAction

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å "–ø–µ—á–∞—Ç–∞–µ—Ç..." –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
await context.bot.send_chat_action(
    chat_id=update.effective_chat.id,
    action=ChatAction.TYPING
)
```

## –¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–Ω—ã –§–æ—Ä—Å–∞–π—Ç-—Å–µ—Å—Å–∏–∏

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `test_forsight_price.py` —Å —Ç—Ä–µ–º—è —Ç–µ—Å—Ç–∞–º–∏:

1. **–¢–µ—Å—Ç 1: LangGraph RAG** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ LangGraph –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ü–µ–Ω—É
2. **–¢–µ—Å—Ç 2: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–∏—Å–∫ –≤ Qdrant –Ω–∞–ø—Ä—è–º—É—é
3. **–¢–µ—Å—Ç 3: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —É—Å–ª—É–≥–∏ –≤ –±–∞–∑–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞:

```bash
python test_forsight_price.py
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
‚úÖ –¢–ï–°–¢ 1 –ü–†–û–ô–î–ï–ù: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤–µ—Ä–Ω—É–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ü–µ–Ω—É
‚úÖ –¢–ï–°–¢ 2 –ü–†–û–ô–î–ï–ù: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ü–µ–Ω—É
‚úÖ –¢–ï–°–¢ 3 –ü–†–û–ô–î–ï–ù: –£—Å–ª—É–≥–∞ –µ—Å—Ç—å –≤ –±–∞–∑–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π

‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!
‚úÖ –¶–µ–Ω–∞ '–æ—Ç 90 000 —Ä—É–±–ª–µ–π' –¥–ª—è '–§–æ—Ä—Å–∞–π—Ç - —Å–µ—Å—Å–∏—è' –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!
```

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 1. –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥–∏

–£—Å–ª—É–≥–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å `source_type="service"`:

```python
from qdrant_helper import index_services, get_services

# –ü–æ–ª—É—á–∞–µ–º —É—Å–ª—É–≥–∏ –∏–∑ Google Sheets
services = get_services()

# –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º (—Ç–µ–ø–µ—Ä—å —Å source_type="service")
if index_services(services):
    print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–æ {len(services)} —É—Å–ª—É–≥")
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –¢–µ—Å—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ü–µ–Ω—ã
python test_forsight_price.py

# –û–±—â–∏–π —Ç–µ—Å—Ç RAG
python test_langgraph_rag.py
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Telegram

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É:
```
–§–æ—Ä—Å–∞–π—Ç - —Å–µ—Å—Å–∏—è. - –∫–∞–∫–∞—è —Ü–µ–Ω–∞
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ø–µ—á–∞—Ç–∞–µ—Ç..." (typing indicator)
- ‚úÖ –û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ—á–Ω—É—é —Ü–µ–Ω—É: "–æ—Ç 90 000 —Ä—É–±–ª–µ–π"
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ß–µ–∫–ª–∏—Å—Ç:

- [ ] –£—Å–ª—É–≥–∏ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã —Å `source_type="service"`
- [ ] –¢–µ—Å—Ç `test_forsight_price.py` –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] –ü–æ–∏—Å–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —É—Å–ª—É–≥–∏ (–Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)
- [ ] –¶–µ–Ω—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–µ `0‚ÇΩ`)
- [ ] Typing indicator —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Telegram
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Qdrant Cloud
üîç –ù–∞–π–¥–µ–Ω–æ 10 —É—Å–ª—É–≥ –≤ Qdrant –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ '–§–æ—Ä—Å–∞–π—Ç - —Å–µ—Å—Å–∏—è. - –∫–∞–∫–∞—è —Ü–µ–Ω–∞'
  üìã –§–æ—Ä—Å–∞–π—Ç - —Å–µ—Å—Å–∏—è - –æ—Ç 90 000 —Ä—É–±–ª–µ–π (score: 0.850)
  üìã –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è —Å–µ—Å—Å–∏—è - –æ—Ç 85 000 —Ä—É–±–ª–µ–π (score: 0.720)
  ...
üí∞ –ò–∑–≤–ª–µ—á–µ–Ω–æ 10 —É—Å–ª—É–≥ —Å —Ü–µ–Ω–∞–º–∏
‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
‚úÖ –û—Ç–≤–µ—Ç —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (–≤–∞–ª–∏–¥–∞—Ü–∏—è: True)
```

**–í–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ:**
```
üìã  - 0‚ÇΩ (score: 0.663)
üìã –†–∞–±–æ—á–∞—è_—Ç–µ—Ç—Ä–∞–¥—å_—Ç—Ä–µ–Ω–∏–Ω–≥–∞_–ò–ò_HR_—Ñ–∏–Ω.docx - 0‚ÇΩ (score: 0.579)
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é:**
   ```python
   from qdrant_helper import get_qdrant_client
   
   client = get_qdrant_client()
   scroll_result = client.scroll(
       collection_name="hr2137_bot_knowledge_base",
       limit=100,
       with_payload=True
   )
   
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É—Å–ª—É–≥–∏ –∏–º–µ—é—Ç source_type="service"
   for point in scroll_result[0]:
       payload = point.payload
       if payload.get("title") and "—Ñ–æ—Ä—Å–∞–π—Ç" in payload.get("title", "").lower():
           print(f"–£—Å–ª—É–≥–∞: {payload.get('title')}")
           print(f"source_type: {payload.get('source_type')}")
           print(f"price_str: {payload.get('price_str')}")
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∏–ª—å—Ç—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –º–µ—à–∞—é—Ç

3. **–û—á–∏—Å—Ç–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–π—Ç–µ:**
   ```python
   from qdrant_helper import get_qdrant_client
   
   client = get_qdrant_client()
   client.delete_collection("hr2137_bot_knowledge_base")
   
   # –ó–∞—Ç–µ–º –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–π—Ç–µ —É—Å–ª—É–≥–∏
   from qdrant_helper import index_services, get_services
   services = get_services()
   index_services(services)
   ```

## –ò—Ç–æ–≥

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —É—Å–ª—É–≥:
- –ü–æ–∏—Å–∫ –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–æ–ª—å–∫–æ —É—Å–ª—É–≥–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏
- Typing indicator –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ Telegram
- –¢–µ—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω—ã –§–æ—Ä—Å–∞–π—Ç-—Å–µ—Å—Å–∏–∏ (90 000 —Ä—É–±–ª–µ–π)
