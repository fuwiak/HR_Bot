# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ Markdown

## –ü—Ä–æ–±–ª–µ–º–∞

```
telegram.error.BadRequest: Can't parse entities: can't find end of the entity starting at byte offset 122
```

### –ü—Ä–∏—á–∏–Ω–∞

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ backticks `` ` `` –≤ Markdown —Å —Ä—É—Å—Å–∫–∏–º–∏/–∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Ñ–∞–π–ª–æ–≤ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞ —É Telegram API.

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –∫–æ–¥–∞:**
```python
await update.message.reply_text(
    f"‚è≥ –ó–∞–≥—Ä—É–∂–∞—é –¥–æ–∫—É–º–µ–Ω—Ç `{file_name}`...",  # ‚ùå –ü—Ä–æ–±–ª–µ–º–∞!
    parse_mode='Markdown'
)
```

–ï—Å–ª–∏ `file_name` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `–ú–µ—Ç–æ–¥–∏–∫–∏_–ø–æ–¥–±–æ—Ä–∞.pdf`), Telegram –Ω–µ –º–æ–∂–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å Markdown.

---

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–±—Ä–∞—Ç—å parse_mode (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `parse_mode='Markdown'` –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Ñ–∞–π–ª–æ–≤:

```python
await update.message.reply_text(
    f"‚è≥ –ó–∞–≥—Ä—É–∂–∞—é –¥–æ–∫—É–º–µ–Ω—Ç: {file_name}"  # ‚úÖ –ë–µ–∑ Markdown
)
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω Markdown, —ç–∫—Ä–∞–Ω–∏—Ä—É–π—Ç–µ –≤—Å–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã:

```python
from telegram.helpers import escape_markdown

file_name_escaped = escape_markdown(file_name, version=2)
await update.message.reply_text(
    f"‚è≥ –ó–∞–≥—Ä—É–∂–∞—é –¥–æ–∫—É–º–µ–Ω—Ç: `{file_name_escaped}`",
    parse_mode='MarkdownV2'  # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ MarkdownV2!
)
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTML –≤–º–µ—Å—Ç–æ Markdown:

```python
import html

file_name_escaped = html.escape(file_name)
await update.message.reply_text(
    f"‚è≥ –ó–∞–≥—Ä—É–∂–∞—é –¥–æ–∫—É–º–µ–Ω—Ç: <code>{file_name_escaped}</code>",
    parse_mode='HTML'
)
```

---

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –í `handle_document()` —Ñ—É–Ω–∫—Ü–∏–∏:

**–î–æ (—Å –æ—à–∏–±–∫–∞–º–∏):**
```python
status_msg = await update.message.reply_text(
    f"‚è≥ –ó–∞–≥—Ä—É–∂–∞—é –¥–æ–∫—É–º–µ–Ω—Ç `{file_name}`...\n"
    f"–†–∞–∑–º–µ—Ä: {document.file_size / 1024:.1f} –ö–ë",
    parse_mode='Markdown'  # ‚ùå
)
```

**–ü–æ—Å–ª–µ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):**
```python
status_msg = await update.message.reply_text(
    f"‚è≥ –ó–∞–≥—Ä—É–∂–∞—é –¥–æ–∫—É–º–µ–Ω—Ç: {file_name}\n"
    f"–†–∞–∑–º–µ—Ä: {document.file_size / 1024:.1f} –ö–ë"
    # –ë–µ–∑ parse_mode ‚úÖ
)
```

### –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:

1. **–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏:**
   ```python
   f"‚è≥ –ó–∞–≥—Ä—É–∂–∞—é –¥–æ–∫—É–º–µ–Ω—Ç: {file_name}\n"
   f"–†–∞–∑–º–µ—Ä: {document.file_size / 1024:.1f} –ö–ë"
   ```

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
   ```python
   f"‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –¥–æ–∫—É–º–µ–Ω—Ç: {file_name}\n"
   f"–ò–∑–≤–ª–µ–∫–∞—é —Ç–µ–∫—Å—Ç –∏ —Å–æ–∑–¥–∞—é —á–∞–Ω–∫–∏..."
   ```

3. **–û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞:**
   ```python
   f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞: {file_name}\n"
   f"–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç."
   ```

4. **–£—Å–ø–µ—à–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:**
   ```python
   f"‚úÖ –î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π!\n\n"
   f"üìÑ –§–∞–π–ª: {file_name}\n"
   f"üìä –°–æ–∑–¥–∞–Ω–æ —á–∞–Ω–∫–æ–≤: {result['chunks_count']}\n"
   f"üÜî ID –¥–æ–∫—É–º–µ–Ω—Ç–∞: {result['doc_id']}\n\n"
   ```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç (–±–µ–∑ parse_mode):

- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤, –∏–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- –ß–∏—Å–ª–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
- –õ—é–±–æ–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã

### ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Markdown/HTML:

- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç–µ
- –ö–æ–≥–¥–∞ —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –Ω–µ—Ç —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
- –ü–æ—Å–ª–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

### ‚ö†Ô∏è –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ Markdown:

–í –æ–±—ã—á–Ω–æ–º Markdown (`parse_mode='Markdown'`):
- `` ` `` backtick
- `*` asterisk
- `_` underscore
- `[` –∏ `]` –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏

–í MarkdownV2 (`parse_mode='MarkdownV2'`):
- –í—Å–µ –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –ø–ª—é—Å: `(`, `)`, `~`, `>`, `#`, `+`, `-`, `=`, `|`, `{`, `}`, `.`, `!`

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç —Å —Ä—É—Å—Å–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º:

```python
file_name = "–ú–µ—Ç–æ–¥–∏–∫–∏_–ø–æ–¥–±–æ—Ä–∞_–ø–µ—Ä—Å–æ–Ω–∞–ª–∞.pdf"
await update.message.reply_text(
    f"‚è≥ –ó–∞–≥—Ä—É–∂–∞—é: {file_name}"  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
)
```

### –¢–µ—Å—Ç —Å–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏:

```python
file_name = "–§–∞–π–ª (–≤–µ—Ä—Å–∏—è 2.0) [–∫–æ–ø–∏—è].docx"
await update.message.reply_text(
    f"‚è≥ –ó–∞–≥—Ä—É–∂–∞—é: {file_name}"  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
)
```

---

## –ò—Ç–æ–≥–æ

‚úÖ –£–±—Ä–∞–Ω—ã –≤—Å–µ `parse_mode='Markdown'` –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Ñ–∞–π–ª–æ–≤  
‚úÖ –¢–µ–ø–µ—Ä—å –±–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤  
‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ `BadRequest: Can't parse entities`  
‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è —á–∏—Ç–∞–µ–º—ã–º–∏ —Å —ç–º–æ–¥–∑–∏  

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! üéâ**
