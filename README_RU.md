# RomanBot - Чат-бот для салона красоты

Бот для автоматизации записи клиентов в салон красоты.

## Что было сделано

### ✅ Основные изменения

1. **Замена API на OpenRouter**
   - Используется модель `x-ai/grok-4.1-fast:free`
   - Переменные: `OPENROUTER_API_KEY`, `OPENROUTER_API_URL`

2. **Интеграция с Google Sheets**
   - Создан модуль `google_sheets_helper.py`
   - Поддержка placeholder режима (работа без настроенных Google Sheets)
   - Функции для работы с мастерами, услугами и записями

3. **Обновлены промпты**
   - Адаптированы под требования встречи
   - Роман (мужской зал) и Анжела (женский зал)
   - Дружелюбный стиль общения на "вы"

4. **Удалена интеграция YClients**
   - Все функции переписаны для работы с Google Sheets

## Переменные окружения

```bash
TELEGRAM_TOKEN=your_telegram_bot_token
OPENROUTER_API_KEY=your_openrouter_api_key
OPENROUTER_API_URL=https://openrouter.ai/api/v1/chat/completions

# Опционально (для Google Sheets):
GOOGLE_SHEETS_CREDENTIALS_PATH=/path/to/credentials.json
GOOGLE_SHEETS_SPREADSHEET_ID=your_spreadsheet_id
```

## Установка и запуск

1. Установить зависимости:
```bash
pip install -r requirements.txt
```

2. Создать `.env` файл с переменными окружения

3. Запустить бота:
```bash
python app.py
```

## Структура проекта

- `app.py` - основной файл бота
- `google_sheets_helper.py` - модуль для работы с Google Sheets
- `requirements.txt` - зависимости проекта
- `Dockerfile` - для Docker деплоя
- `docker-compose.yml` - для локальной разработки

## Google Sheets Интеграция

Бот работает с вашей Google таблицей:
- **Чтение услуг**: Лист "Ценник" - автоматически читает все услуги с ценами
- **Запись записей**: Лист "Запись" - каждая новая запись добавляется в новую строку
- **Отслеживание изменений**: Кэш обновляется каждые 5 минут

**Spreadsheet ID**: `1NF25EWqRxjdNTKk4VFVAYZGIOlVFfaktpEvvj1bRXKU` (установлен по умолчанию)

### Настройка

См. подробную инструкцию: `GOOGLE_SHEETS_SETUP.md`

### Placeholder режим

Если Google Sheets не настроены (`GOOGLE_SHEETS_CREDENTIALS_PATH` не указан), бот работает с placeholder данными:
- Мастера: Роман (мужской зал), Анжела (женский зал)
- Базовый список услуг
- Записи сохраняются в памяти (неперсистентно)

## Что еще нужно доработать

1. ✅ Обработка жалоб (промпт создан, логика - в процессе)
2. ✅ Передача диалога человеку
3. ✅ Логика скидок (25% первый визит, 10% по запросу, 25% день рождения)
4. ✅ Акции ("Приведи друга", "Воск комплекс за отзыв")
5. ✅ Проверка графика работы мастеров
6. ✅ Формат подтверждения записи

## Примечания

- Бот отвечает на сообщения круглосуточно
- Поддерживается запись "стык в стык" и "на сейчас"
- Допустимое опоздание - 10 минут
- Клиенты могут отменить/перенести запись

## Разработка

Для локальной разработки с Docker:
```bash
docker-compose up --build
```

Для деплоя на Railway - использовать существующие конфигурационные файлы.


